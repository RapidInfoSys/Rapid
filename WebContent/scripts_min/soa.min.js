var _soaDetails={};var _soaDataTypes=[{name:"string",value:1},{name:"integer",value:2},{name:"decimal",value:3},{name:"date",value:4},{name:"dateTime",value:5}];var _soaRestrictions=[];var _soaRestrictionTypes=[{type:"MinOccursRestriction",name:"minOccurs"},{type:"MaxOccursRestriction",name:"maxOccurs"},{type:"MinLengthRestriction",name:"minLength",dataTypes:[1]},{type:"MaxLengthRestriction",name:"maxLength",dataTypes:[1]},{type:"EnumerationRestriction",name:"enumeration",dataTypes:[1]}];var _listeners=[];$(document).mouseup(function(ev){_reorderDetails=null});function getSOADataTypeSelect(selectedDataType){var select="<select>";for(var i in _soaDataTypes){select+="<option value='"+_soaDataTypes[i].value+"' "+(selectedDataType==_soaDataTypes[i].value?"selected='selected'":"")+">"+_soaDataTypes[i].name+"</option>"}select+="</select>";return select}function getSOARestrictionSelect(selectedDataType,selectedRestriction){var select="<select>";for(var i in _soaRestrictionTypes){var restrictionType=_soaRestrictionTypes[i];
var restrictionMatchesType=false;if(restrictionType.dataTypes){for(var j in restrictionType.dataTypes){if(selectedDataType==restrictionType.dataTypes[j]){restrictionMatchesType=true;break}}}if(!restrictionType.dataTypes||restrictionMatchesType){select+="<option value='"+restrictionType.type+"' "+(selectedRestriction==restrictionType.type?"selected='selected'":"")+">"+restrictionType.name+"</option>"}}select+="</select>";return select}function getRestrictionLabel(restriction){for(var i in _soaRestrictionTypes){var restrictionType=_soaRestrictionTypes[i];if(restrictionType.type==restriction.type){return restrictionType.name+"("+restriction.value+")"}}return"unknown"}function showSOARestrictions(collection,control){var element=collection[control.parent().index()-1];if(!element.restrictions){element.restrictions=[]}_soaRestrictions=element.restrictions;var dialogue=$("#restrictionsDialogue");if(!dialogue[0]){$("body").append("<div id='restrictionsDialogue' style='position:absolute;display:none;width:280px;border:1px solid black;background-color:white;font-size:11px;padding:10px;'></div>");
dialogue=$("#restrictionsDialogue");var close=dialogue.append("<b style='float:left;margin-top:-5px;'>Restrictions</b><a href='#' style='float:right;margin-top:-5px;'>close</a></div>").children().last();_listeners.push(close.click(function(ev){dialogue.hide()}));dialogue.append("<table class='propertiesPanelTable'></table>")}dialogue.find("a.add").last().remove();dialogue.append("<a href='#' class='add'>add...</a>").find("a").last().click({collection:collection,control:control},function(ev){_soaRestrictions.push({type:"MinOccursRestriction",value:"1"});showSOARestrictions(ev.data.collection,ev.data.control)});var table=dialogue.find("table");table.html("<tr><td style='padding-top:0;'><b>Type</b></td><td><b>Value</b></td><td style='width:32px;'>&nbsp;</td></tr>");for(var i in _soaRestrictions){var restriction=_soaRestrictions[i];table.append("<tr><td>"+getSOARestrictionSelect(element.dataType,restriction.type)+"</td><td><input value='"+restriction.value+"'/></td><td><img class='delete' src='images/bin_16x16.png' /><img class='reorder' src='images/moveUpDown_16x16.png' /></td></tr>")
}table.find("select").change(function(ev){var select=$(ev.target);_soaRestrictions[select.parent().parent().index()-1].type=select.val()});table.find("input").keyup(function(ev){var input=$(ev.target);_soaRestrictions[input.parent().parent().index()-1].value=input.val()});table.find("img.delete").click({collection:collection,control:control},function(ev){_soaRestrictions.splice($(ev.target).parent().parent().index()-1,1);showSOARestrictions(ev.data.collection,ev.data.control)});addReorder(_soaRestrictions,table.find("img.reorder"),function(ev){showSOARestrictions(collection,control)});dialogue.css({top:control.offset().top,left:control.offset().left-200,display:"block"})}function loadSOA(details){$("#rapid_P0_C489_").hide();$("#rapid_P0_C991_").hide();switch(details.type){case"SQLWebservice":_soaDetails=details;if(!details.name){details.name=""}$("#rapid_P0_C496_").val(details.name);if(!details.databaseConnectionIndex){details.databaseConnectionIndex=0}$("#rapid_P0_C536_").val(details.databaseConnectionIndex);
if(!details.SQL){details.SQL=""}$("#rapid_P0_C559_").val(details.SQL);var requestCell=$("#rapid_P0_C589_");var requestTable=requestCell.children("table");if(!requestTable[0]){requestTable=requestCell.append("<table class='propertiesPanelTable'></table>").children("table")}requestTable.html("<tr><td>Child element name</td><td>Data type</td><td>Restrictions</td><td style='width:32px;min-width:32px;'>&nbsp;</td></tr>");if(details.requestSchema&&details.requestSchema.rootElement){var requestElement=details.requestSchema.rootElement;$("#rapid_P0_C593_").val(requestElement.name);for(var i in requestElement.childElements){var element=requestElement.childElements[i];var text="click to add...";if(element.restrictions&&element.restrictions.length>0){text="";for(var j in element.restrictions){text+=getRestrictionLabel(element.restrictions[j])}}requestTable.append("<tr><td class='elementName'><input value='"+element.name+"' /></td><td>"+getSOADataTypeSelect(element.dataType)+"</td><td class='restriction'>"+text+"</td><td><img class='delete' src='images/bin_16x16.png' /><img class='reorder' src='images/moveUpDown_16x16.png' /></td></tr>")
}requestTable.find("input").keyup(details,function(ev){var input=$(ev.target);ev.data.requestSchema.rootElement.childElements[input.parent().parent().index()-1].name=input.val()});requestTable.find("select").change(details,function(ev){var select=$(ev.target);ev.data.requestSchema.rootElement.childElements[select.parent().parent().index()-1].dataType=select.val()});requestTable.find("td.restriction").click(details,function(ev){showSOARestrictions(requestElement.childElements,$(ev.target))});addReorder(requestElement.childElements,requestTable.find("img.reorder"),function(ev){loadSOA(details)});requestTable.find("img.delete").click(details,function(ev){ev.data.requestSchema.rootElement.childElements.splice($(ev.target).parent().parent().index()-1,1);loadSOA(ev.data)})}else{$("#rapid_P0_C593_").val("")}requestTable.append("<tr><td colspan='4'>add...</td></tr>");requestTable.find("td").last().click(details,function(ev){if(!ev.data.requestSchema){ev.data.requestSchema={}}var requestSchema=ev.data.requestSchema;
if(!requestSchema.rootElement){requestSchema.rootElement={}}var requestElement=requestSchema.rootElement;if(!requestElement.childElements){requestElement.childElements=[]}requestElement.childElements.push({name:"",dataType:1});loadSOA(ev.data)});var responseCell=$("#rapid_P0_C592_");var responseTable=responseCell.children("table");if(!responseTable[0]){responseTable=responseCell.append("<table class='propertiesPanelTable'></table>").children("table")}responseTable.html("<tr><td>Child element name</td><td>Field</td><td>Data type</td><td>Restrictions</td><td style='width:32px;min-width:32px;'>&nbsp;</td></tr>");if(details.responseSchema&&details.responseSchema.rootElement){var responseElement=details.responseSchema.rootElement;$("#rapid_P0_C594_").val(responseElement.name);setData_radiobuttons("rapid_P0_C598_","'"+responseElement.isArray+"'");for(var i in responseElement.childElements){var element=responseElement.childElements[i];var text="click to add...";if(element.restrictions&&element.restrictions.length>0){text="";
for(var j in element.restrictions){text+=getRestrictionLabel(element.restrictions[j])}}responseTable.append("<tr><td class='elementName'><input class='elementName' value='"+element.name+"' /></td><td class='elementField'><input class='elementField' value='"+element.field+"' /></td><td>"+getSOADataTypeSelect(element.dataType)+"</td><td class='restriction'>"+text+"</td><td><img class='delete' src='images/bin_16x16.png' /><img class='reorder' src='images/moveUpDown_16x16.png' /></td></tr>")}responseTable.find("input.elementName").keyup(details,function(ev){var input=$(ev.target);ev.data.responseSchema.rootElement.childElements[input.parent().parent().index()-1].name=input.val()});responseTable.find("input.elementField").keyup(details,function(ev){var input=$(ev.target);ev.data.responseSchema.rootElement.childElements[input.parent().parent().index()-1].field=input.val()});responseTable.find("select").change(details,function(ev){var select=$(ev.target);ev.data.responseSchema.rootElement.childElements[select.parent().parent().index()-1].dataType=select.val()
});responseTable.find("td.restriction").click(details,function(ev){showSOARestrictions(responseElement.childElements,$(ev.target))});addReorder(responseElement.childElements,responseTable.find("img.reorder"),function(ev){loadSOA(details)});responseTable.find("img.delete").click(details,function(ev){ev.data.responseSchema.rootElement.childElements.splice($(ev.target).parent().parent().index()-1,1);loadSOA(ev.data)})}else{$("#rapid_P0_C594_").val("");setData_radiobuttons("rapid_P0_C598_","false")}responseTable.append("<tr><td colspan='4'>add...</td></tr>");responseTable.find("td").last().click(details,function(ev){if(!ev.data.responseSchema){ev.data.responseSchema={}}var responseSchema=ev.data.responseSchema;if(!responseSchema.rootElement){responseSchema.rootElement={}}var responseElement=responseSchema.rootElement;if(!responseElement.childElements){responseElement.childElements=[]}responseElement.childElements.push({name:"",field:"",dataType:1});loadSOA(ev.data)});$("#rapid_P0_C489_").show();
break;case"JavaWebservice":$("#rapid_P0_C944_").val(details.name);$("#rapid_P0_C989_").val(details.className);$("#rapid_P0_C991_").show();break}}function submitWebservice(){var action=$("#action").val();var header={SOAPAction:action};var contentType=$("input[name=contentType]:checked").val();if(contentType=="application/json"){header={Action:action}}var data=$("#request").val();$.ajax({url:"soa",type:"POST",data:data,headers:header,contentType:contentType,error:function(server,status,error){$("#response").text(error+" "+server.responseText)},success:function(response){if(response.xmlVersion){var xml=(typeof XMLSerializer!=="undefined")?(new window.XMLSerializer()).serializeToString(response):response.xml;$("#response").text(xml)}else{$("#response").text(JSON.stringify(response))}}})};