<?xml version="1.0" encoding="ISO-8859-1" ?>
<actions xmlVersion="1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../schemas/action.xsd">

<!-- 

Copyright (C) 2016 - Gareth Edwards / Rapid Information Systems

gareth.edwards@rapid-is.co.uk


This file is part of the Rapid Application Platform

Rapid is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version. The terms require you to include
the original copyright, and the license notice in all redistributions.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
in a file named "COPYING".  If not, see <http://www.gnu.org/licenses/>.

 -->

    <action>
    
        <type>rapid</type>
        <name>Rapid</name>
	    <class>com.rapid.actions.Rapid</class>
	    <helpHtml>These actions are used by the Rapid Admin application.</helpHtml>
	    
	    <properties>
	        <property>
	            <key>actionType</key>
	            <name>Type</name>
	            <setConstructValueFunction>return "NONE";</setConstructValueFunction>
	            <changeValueJavaScript>select</changeValueJavaScript>
	            <getValuesFunction>
	                <![CDATA[
return [
 ["NONE","None"],
 ["GETAPPS","Get applications"],
 ["GETVERSIONS","Get versions"],
 ["GETVERSION","Get version"],
 ["GETDBCONN","Get database connection details"],
 ["GETSOA","Get soa webservice details"],
 ["GETSEC","Get security details"],  
 ["GETUSERS","Get users"],
 ["GETUSER","Get user details"],
 ["GETSESSIONS","Get session details"],
 ["GETPARAM","Get parameter details"],
 ["GETRESOURCE","Get resource details"],
 ["GETDEVICE","Get device details"],    
 ["RELOADACTIONS","Reload actions"],
 ["RELOADCONTROLS","Reload controls"],
 ["RELOADAPPLICATIONS","Reload applications"], 
 ["RELOADADAPTERS","Reload adapters"],
 ["RELOADPROCESSES","Reload processes"],
 ["RELOADVERSION","Reload version"],
 ["SAVEAPP","Save application details"], 
 ["SAVESTYLES","Save styles"],
 ["SAVEFUNCTIONS","Save functions"],  
 ["SAVEDBCONN","Save database connection"],
 ["SAVESOASQL","Save SQL webservice"],
 ["SAVESOAJAVA","Save Java webservice"],
 ["SAVESECURITYADAPT","Save security adapter"],
 ["SAVEACTIONS","Save actions"],
 ["SAVECONTROLS","Save controls"],    
 ["NEWAPP","New application"],
 ["DELAPP","Delete application"], 
 ["DUPAPP","Duplicate application version"],
 ["NEWVERSION","New application version"],
 ["DELVERSION","Delete application version"], 
 ["NEWPAGE","New page"],
 ["DELPAGE","Delete page"],
 ["NEWDBCONN","New database connection"],
 ["DELDBCONN","Delete database connection"],
 ["NEWSOA","New SOA webservice"],
 ["DELSOA","Delete SOA webservice"],
 ["NEWROLE","New role"],
 ["DELROLE","Delete role"],
 ["SAVEROLE","Save role description"],
 ["NEWUSER","New user"],
 ["DELUSER","Delete user"],
 ["NEWUSERROLE","New user role"],
 ["DELUSERROLE","Delete user role"],
 ["SAVEUSER","Save user descrition, password, device, and roles"],
 ["NEWPARAM","New parameter"],
 ["DELPARAM","Delete parameter"],
 ["SAVEPARAM","Save parameter"],
 ["NEWRESOURCE","New resource"],
 ["DELRESOURCE","Delete resource"],
 ["SAVERESOURCE","Save resource"],
 ["NEWDEVICE","New device"],
 ["DELDEVICE","Delete device"],
 ["SAVEDEVICE","Save device"],
 ["REBUILDPAGES","Rebuild application pages"],
 ["TESTDBCONN","Test database connection"],
 ["TESTEMAIL","Test SMTP server"],
 ["SAVEEMAIL","Save SMTP server details"],
 ["DELAPPBACKUP","Delete application backup"],
 ["DELPAGEBACKUP","Delete page backup"],
 ["RESTOREAPPBACKUP","Restore application backup"],
 ["RESTOREPAGEBACKUP","Restore page backup"],
 ["SAVEAPPBACKUPSIZE","Save number of application backups"],
 ["SAVEPAGEBACKUPSIZE","Save number of page backups"]
];
					]]>
	            </getValuesFunction>  
	        </property>
	        <property>
	            <key>rapidApp</key>
	            <name>Rapid application</name>
	            <changeValueJavaScript>checkbox</changeValueJavaScript>	 
	        </property>
	        <property>
	            <key>successActions</key>
	            <name>Success actions</name>
	            <changeValueJavaScript>childActions</changeValueJavaScript>	 
	        </property>
	        <property>
	            <key>errorActions</key>
	            <name>Error actions</name>
	            <changeValueJavaScript>childActions</changeValueJavaScript>	 
	        </property>	 
	    </properties>
	    
	    <resources>
	        <resource>
	            <type>javascriptFile</type>
	            <contents>scripts/soa.js</contents>
	        </resource>
	        <resource>
	            <type>javascriptFile</type>
	            <contents>scripts/reorder.js</contents>
	        </resource>
	        <resource>
	            <type>javascriptFile</type>
	            <contents>scripts/properties.js</contents>
	        </resource>
	        <resource>
	            <type>cssFile</type>
	            <contents>styles/properties.css</contents>
	        </resource>
	    </resources>
	    
	    <actionJavaScript>
	        <![CDATA[

// a global for holding the userName which we get when calling GETAPPS	        
var _userName = "";	        
	        
function Action_rapid(ev, appId, pageId, controlId, actionId, actionType, rapidApp, successCallback, errorCallback) {

	var type = "GET";
	
	var data = null;
	var callback = null;
	
	// get a ref to the control that iniated this action	
	var target = $(ev.target);
	// disable it if a button
	if (target.is("button")) target.disable();

	// some special types require data and callbacks	
	switch (actionType) {
		case "GETAPPS" :		
			data = { actionType: actionType, appId: "rapid" };	
			callback = function(data) {			
				setData_dataStore(ev,'rapid_P0_C210', null, {storageType:"S"}, data);									
			};
		break;
		case "GETVERSIONS" :	
			var appId = $("#rapid_P0_C43").val();
			if (appId) {
				data = { actionType: actionType, appId: appId  };	
				callback = function(data) {
					setData_dataStore(ev, 'rapid_P0_C1063_', "versions", {storageType:"S"}, data);
				};
			} else {
				return false;
			}
		break;
		case "GETVERSION" :		
			var appId = $("#rapid_P0_C43").val();
			var version = $("#rapid_P0_C1044_").val();
			if (appId && version) {
				data = { actionType: actionType, appId: appId, version: version };	
				callback = function(data) {
					setData_dataStore(ev, 'rapid_P0_C1072_', null, {storageType:"S"}, data);
				};
			} else {
				return false;
			}
		break;	
		case "GETDBCONN" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $("#rapid_P0_C311").find("tr.rowSelect").index()-1 };	
			callback = function(data) {
				setData_dataStore(ev, 'rapid_P0_C361', "databaseConnection", {storageType:"S"}, data);
			};
		break;
		case "GETSOA" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $("#rapid_P0_C483_").find("tr.rowSelect").index()-1 };	
			callback = function(data) {
				setData_dataStore(ev, 'rapid_P0_C528_', "webservice", {storageType:"S"}, data);
				loadSOA(data.webservice);
			};
		break;
		case "GETSEC" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), securityAdapter: $("#rapid_P0_C81").val() };	
			callback = function(data) {
				setData_dataStore(ev, 'rapid_P0_C469_', "security", {storageType:"S"}, data);
			};
		break;					
		case "GETUSERS" :		
			data = { actionType: actionType, appId: "rapid" };	
			callback = function(data) {			    				
				setData_grid(ev, 'rapid_P0_C823_', 'users', {"rowSelect":true,"columns":[{"field":"name","visible":true,"style":"text-align:left;padding-left:10px;"},{"field":"description","visible":true,"style":"text-align:left;padding-left:10px;padding-right:10px;"},{"cellFunction":"","field":"","visible":true,"style":""}]}, data);
				var rapidUserRows = $("#rapid_P0_C823_").find("tr.rowStyle1,tr.rowStyle2");
				rapidUserRows.each( function() {
				  var children = $(this).children("td");
				  var user = children.first().html();
				  if (data.currentUser.toLowerCase() != user.toLowerCase()) {
					  var cell = children.last();
					  cell.html("<button>delete...</button>");
					  cell.find("button").click( function(ev) {
					    // confirm
					    if (confirm("Are you sure?")) {    
					      Action_rapid(ev, 'rapid', 'P0', null, 'P0_A904_', 'DELUSER', true);					      
					    }
					    // stop bubbling
					    ev.stopPropagation();
					  });
				   }
				});
			};
		break;
		case "GETUSER" :	
			if (rapidApp) {
				data = { actionType: actionType, appId: "rapid", version: _appVersion, userName: getData_grid(ev, "rapid_P0_C823_", "name", {columns:[{field:"name"}]}) };
			} else {
				data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), userName: getData_grid(ev, "rapid_P0_C216", "userName", {columns:[{field:"userName"}]}) };	
			}
			callback = function(data) {
				setData_dataStore(ev, 'rapid_P0_C243', "user", {storageType:"S"}, data);
			};
		break;	
		case "GETPARAM" :	
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $("#rapid_P0_C1108_").find("tr.rowSelect").index()-1 };
			callback = function(data) {
				setData_dataStore(ev, 'rapid_P0_C1145_', "parameter", {storageType:"S"}, data);
			};
		break;
		case "GETRESOURCE" :	
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $("#rapid_P0_C1344_").find("tr.rowSelect").index()-1 };
			callback = function(data) {
				setData_dataStore(ev, 'rapid_P0_C1401_', "resource", {storageType:"S"}, data);
			};
		break;
		case "GETDEVICE" :	
			data = { actionType: actionType, appId: "rapid", version: _appVersion, index: $("#rapid_P0_C1199_").find("tr.rowSelect").index()-1 };
			callback = function(data) {
				setData_dataStore(ev, 'rapid_P0_C1269_', "device", {storageType:"S"}, data);
			};
		break;
		case "GETSESSIONS" :	
			data = { actionType: actionType, appId: "rapid", version: _appVersion };
			callback = function(data) {
				setData_grid(ev, 'rapid_P0_C1485_', "sessions", rapid_P0_C1485_details, data);
			};
		break;
		case "RELOADVERSION" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val()
			};	
		break;
		case "SAVEAPP" :		
			data = { 
				actionType: actionType,
				appId: $("#rapid_P0_C43").val(),
				version: $("#rapid_P0_C1044_").val(),
				status: $("#rapid_P0_C1098_").val(),
				name: $("#rapid_P0_C392_").val(),
				saveVersion: $("#rapid_P0_C1077_").val(),
				title: $("#rapid_P0_C394_").val(),
				description: $("#rapid_P0_C393_").val(),
				formAdapter: $("#rapid_P0_C1406_").val(),
				isForm: getData_checkbox(ev, "rapid_P0_C1826_"), 
				startPageId: $("#rapid_P0_C644_").val(),
				showControlIds: getData_checkbox(ev, "rapid_P0_C381_"),
				showActionIds: getData_checkbox(ev, "rapid_P0_C382_"),
				formEmail: getData_checkbox(ev, "rapid_P0_C1874_"),
				formEmailFrom: $("#rapid_P0_C1994_").val(),
				formEmailTo: $("#rapid_P0_C1875_").val(),
				formEmailAttachmentType: $("#rapid_P0_C1876_").val(),
				formFile: getData_checkbox(ev, "rapid_P0_C1878_"),
				formFileType: $("#rapid_P0_C1897_").val(),
				formFilePath: $("#rapid_P0_C1898_").val(),
				formFileUserName: $("#rapid_P0_C1899_").val(),
				formFilePassword: $("#rapid_P0_C1900_").val(),
				formWebservice: getData_checkbox(ev, "rapid_P0_C1905_"),
				formWebserviceURL: $("#rapid_P0_C1903_").val(),
				formWebserviceType: $("#rapid_P0_C1902_").val(),
				formWebserviceSOAPAction: $("#rapid_P0_C1901_").val()
			};	
		break;
		case "SAVESTYLES" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				themeType: $("#rapid_P0_C1570_").val(), 
				styles: $("#rapid_P0_C116").val(),
				statusBarColour: $("#rapid_P0_C1414_").val(), 
				statusBarHighlightColour: $("#rapid_P0_C1418_").val(), 
				statusBarTextColour: $("#rapid_P0_C1415_").val(), 
				statusBarIconColour: $("#rapid_P0_C1416_").val() 
			};	
		break;		
		case "SAVEFUNCTIONS" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), functions: $("#rapid_P0_C1292_").val() };	
		break;	
		case "SAVEDBCONN" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				index: $("#rapid_P0_C311").find("tr.rowSelect").index()-1,
				name: $("#rapid_P0_C360").val(),
				driver: $("#rapid_P0_C338").val(),
				connectionString: $("#rapid_P0_C374").val(),
				connectionAdapter: $("#rapid_P0_C339").val(),
				userName: $("#rapid_P0_C340").val(),
				password: $("#rapid_P0_C341").val()
			};	
			callback = function() {
				Event_click_rapid_P0_C311({target: $("#rapid_P0_C311").find("tr.rowSelect").children().first()[0] });
			};
		break;
		case "SAVESOASQL" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				index: $("#rapid_P0_C483_").find("tr.rowSelect").index()-1,
				name: $("#rapid_P0_C496_").val(), 
				databaseConnectionIndex: $("#rapid_P0_C536_")[0].selectedIndex,
				details: _soaDetails,
				type: "SQLWebservice"
			};	
		break;
		case "SAVESOAJAVA" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				index: $("#rapid_P0_C483_").find("tr.rowSelect").index()-1,
				name: $("#rapid_P0_C944_").val(), 
				className: $("#rapid_P0_C989_").val(),
				type: "JavaWebservice"
			};	
		break;
		case "SAVESECURITYADAPT" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				securityAdapter: $("#rapid_P0_C81").val(),
				deviceSecurity: getData_checkbox(ev, "rapid_P0_C1591_"),
				storePasswordDuration: $("#rapid_P0_C1621_").val()
			};	
		break;
		case "SAVEACTIONS" :
			var actionTypes = [];
			$("#rapid_P0_C288").find("input:checked").each( function(){
				actionTypes.push($(this).closest("tr").children().first().html());
			});		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), actionTypes: actionTypes };	
		break;
		case "SAVECONTROLS" :	
			var controlTypes = [];
			$("#rapid_P0_C289").find("input:checked").each( function(){
				controlTypes.push($(this).closest("tr").children().first().html());
			});		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), controlTypes: controlTypes };	
		break;
		case "REBUILDPAGES" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val() };	
		break;
		case "NEWAPP" :
			data = {
				actionType: actionType,
				appId: "rapid",
				version: "1",
				name: $("#rapid_P1_C7").val(),
				newVersion: $("#rapid_P1_C48_").val(),
				title: $("#rapid_P1_C11").val(),
				type: $("#rapid_P1_C57_").children("input[type=radio]:checked").val(),
				themeType: $("#rapid_P1_C63_").val(),
				description: $("#rapid_P1_C15").val()
			}
			callback = function(response) {
				window.location = "~?a=rapid&p=P0&appId=" + response.appId + "&version=" + response.version;
			}; 
		break;
		case "DELAPP" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val() 
			};	
			callback = function() {
				window.location = "~?a=rapid&p=P0";
			}; 			
		break;		
		case "DUPAPP" :		
			data = {
				actionType: actionType,
				appId: $("#rapid_P0_C43").val(),
				version: $("#rapid_P0_C1044_").val(),
				newVersion: $("#rapid_P8_C7_").val(),
				title: $("#rapid_P8_C12_").val(),
				description: $("#rapid_P8_C17_").val()
			}
			callback = function(response) {
				var url = "~?a=rapid&p=P0";
				if (response.id) url += "&appId=" + response.id;
				if (response.version) url += "&version=" + response.version;
				window.location = url;
			}; 			
		break;				
		case "NEWVERSION" :		
			data = {
				actionType: actionType,
				appId: $("#rapid_P0_C43").val(),
				version: $("#rapid_P0_C1044_").val(),
				newVersion: $("#rapid_P17_C7_").val(),
				title: $("#rapid_P17_C12_").val(),
				description: $("#rapid_P17_C17_").val()
			}
			callback = function(response) {
				var url = "~?a=rapid&p=P0";
				if (response.id) url += "&appId=" + response.id;
				if (response.version) url += "&version=" + response.version;
				window.location = url;
			}; 			
		break;		
		case "DELVERSION" :		
			data = {
				actionType: actionType,
				appId: $("#rapid_P0_C43").val(),
				version: $("#rapid_P0_C1044_").val()
			}
			callback = function(response) {
				location.reload();
			}; 			
		break;				
		case "NEWPAGE" :	
			data = {
				actionType: actionType,
				appId: _version.id,
				version: _version.version,
				id: "P" + _nextPageId, 
				name: $("#rapid_P3_C17").val(),
				title: $("#rapid_P3_C18").val(),
				description: $("#rapid_P3_C19").val()
			}
			callback = function(data) {
				hideDialogue();
				loadPages(data.id, true);
			}; 
		break;
		case "DELPAGE" :
			data = { actionType: actionType, appId: _version.id, version: _version.version, id: _page.id }; 
			callback = function() {
				hideDialogue();
				loadPages(null, true);
			}; 
		break;	
		case "NEWDBCONN" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				name: $("#rapid_P7_C7").val(),
				driver: $("#rapid_P7_C37").val(),
				connectionString: $("#rapid_P7_C44").val(),
				connectionAdapter: $("#rapid_P7_C38").val(),  
				userName: $("#rapid_P7_C30").val(),
				password: $("#rapid_P7_C35").val()
			};	
			callback = function() {
				// reload version
				Event_change_rapid_P0_C1044_(ev);
			};	
		break;
		case "DELDBCONN" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $(ev.target).parent().parent().index()-1 };
			callback = function() {
				// reload everything
				Event_change_rapid_P0_C1044_(ev);
			};	
		break;
		case "NEWSOA" :		
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				name: $("#rapid_P10_C8_").val(),
				type: $("#rapid_P10_C23_").val()
			};	
			callback = function() {
				Event_change_rapid_P0_C1044_(ev);
			};	
		break;
		case "DELSOA" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $(ev.target).parent().parent().index()-1 };
			callback = function() {
				Event_change_rapid_P0_C1044_(ev);
			};	
		break;
		case "NEWROLE" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), role: $("#rapid_P5_C7").val(), description: $("#rapid_P5_C41_").val() };
			callback = function() {
				// fake an adapter change
				$("#rapid_P0_C81").change();
				// fake a tab click
				$("#rapid_P0_C74").click(); 
			};								
		break;
		case "DELROLE" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), role: $(ev.target).closest("tr").find("td").first().html() };
			callback = function() {
				// fake an adapter change
				$("#rapid_P0_C81").change(); 
				// fake a tab click
				$("#rapid_P0_C74").click(); 
			};	
		break;
		case "SAVEROLE" :		
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), role: $("#rapid_P0_C222").find("tr.rowSelect").children().first().html(), description: $("#rapid_P0_C735_").val() };
			callback = function() {
				// fake an adapter change
				$("#rapid_P0_C81").change(); 
				// fake a tab click
				$("#rapid_P0_C74").click(); 
			};							
		break;
		case "NEWUSER" :	
			if (rapidApp) {
				data = { actionType: actionType, 
					appId: "rapid", 
					version : _appVersion, 
					userName: $("#rapid_P16_C8_").val(), 
					description: $("#rapid_P16_C13_").val() , 
					password: $("#rapid_P16_C17_").val(), 
					deviceDetails: $("#rapid_P16_C57_").val(),
					useAdmin: getData_checkbox(ev, "rapid_P16_C38_"),
					useDesign: getData_checkbox(ev, "rapid_P16_C39_")
				};
			} else {	
				data = { actionType: actionType, 
					appId: $("#rapid_P0_C43").val(), 
					version: $("#rapid_P0_C1044_").val(), 
					userName: $("#rapid_P6_C7").val(), 
					description: $("#rapid_P6_C42_").val() , 
					password: $("#rapid_P6_C18").val(),
					deviceDetails: $("#rapid_P6_C70_").val(),
					useAdmin: getData_checkbox(ev, "rapid_P6_C65_"),
					useDesign: getData_checkbox(ev, "rapid_P6_C66_")
				 };
				callback = function() {
					Event_change_rapid_P0_C81(ev);
				};
			}								
		break;
		case "DELUSER" :		
			if (rapidApp) {
				data = { actionType: actionType, appId: "rapid", userName: $(ev.target).closest("tr").find("td").first().html() };
				callback = function() {			
					// hide any currently displayed user details
					$("#rapid_P0_C827_").hide();	
					// reload users
					Action_rapid(ev, 'rapid', 'P0', null, 'P0_A901_', 'GETUSERS', true);
				};
			} else {
				data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), userName: $(ev.target).closest("tr").find("td").first().html() };
				callback = function() {
					// fake an adapter change
					$("#rapid_P0_C81").change(); 
					// fake a tab click
					$("#rapid_P0_C74").click();    
				};
			} 											
		break;
		case "NEWUSERROLE" : 
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), userName: $("#rapid_P0_C216").find("tr.rowSelect").children().first().html(), role: $("#rapid_P0_C254").val() };
			callback = function() {
				Event_click_rapid_P0_C216({target: $("#rapid_P0_C216").find("tr.rowSelect").children().first()[0] });
			};																
		break;
		case "DELUSERROLE" :	
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), userName: $("#rapid_P0_C216").find("tr.rowSelect").children().first().html(), role: $(ev.target).parent().prev().html() };
			callback = function() {
				Event_click_rapid_P0_C216({target: $("#rapid_P0_C216").find("tr.rowSelect").children().first()[0] });
			};																
		break;
		case "SAVEUSER" :	
			if (rapidApp) {
				data = { actionType: actionType, appId: "rapid", version: _appVersion, userName: $("#rapid_P0_C834_").text(), description: $("#rapid_P0_C838_").val(), password: $("#rapid_P0_C843_").val(), deviceDetails: $("#rapid_P0_C1453_").val(), useAdmin: $("#rapid_P0_C879_").prop('checked'), useDesign: $("#rapid_P0_C880_").prop('checked') }; 
			} else {
				data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), userName: $("#rapid_P0_C216").find("tr.rowSelect").children().first().html(), description: $("#rapid_P0_C717_").val(), password: $("#rapid_P0_C231").val(), deviceDetails: $("#rapid_P0_C1444_").val() };
				callback = function() {
					// fake an adapter change
					$("#rapid_P0_C81").change(); 
					// fake a tab click
					$("#rapid_P0_C74").click();    
				};	
			}															
		break;
		case "NEWPARAM" :
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val() };
		break;
		case "DELPARAM" :
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $(ev.target).closest("tr").index()-1 };
		break;
		case "SAVEPARAM" :
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $("#rapid_P0_C1108_").find("tr.rowSelect").index()-1, name: $("#rapid_P0_C1134_").val(), value: $("#rapid_P0_C1123_").val()};
		break;
		case "NEWRESOURCE" :
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val() };
		break;
		case "DELRESOURCE" :
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $(ev.target).closest("tr").index()-1 };
		break;
		case "SAVERESOURCE" :
			data = { actionType: actionType, appId: $("#rapid_P0_C43").val(), version: $("#rapid_P0_C1044_").val(), index: $("#rapid_P0_C1344_").find("tr.rowSelect").index()-1, name: $("#rapid_P0_C1362_").val(), type: $("#rapid_P0_C1398_").val(), value: $("#rapid_P0_C1390_").val()};
		break;
		case "NEWDEVICE" :
			data = { actionType: actionType, appId: "rapid", version: _appVersion };
		break;
		case "DELDEVICE" :
			data = { actionType: actionType, appId: "rapid", version: _appVersion, index: $(ev.target).closest("tr").index()-1 };
		break;
		case "SAVEDEVICE" :
			data = { actionType: actionType, appId: "rapid", version: _appVersion, index: $("#rapid_P0_C1199_").find("tr.rowSelect").index()-1, 
			name: $("#rapid_P0_C1243_").val(), 
			width: $("#rapid_P0_C1217_").val(),
			height: $("#rapid_P0_C1248_").val(),
			ppi: $("#rapid_P0_C1253_").val(),
			scale: $("#rapid_P0_C1258_").val()
		};
		break;
		case "TESTDBCONN" :	
			data = { 
				actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				index: $("#rapid_P0_C311").find("tr.rowSelect").index()-1,
				driver: $("#rapid_P0_C338").val(),
				connectionString: $("#rapid_P0_C374").val(),
				connectionAdapter: $("#rapid_P0_C339").val(),
				userName: $("#rapid_P0_C340").val(),
				password: $("#rapid_P0_C341").val()
			};	
			callback = function(data) {
				alert(data.message);
			};															
		break;
		case "TESTEMAIL" :
			data = {
				actionType: actionType,
				appId: "rapid",
				host: $("#rapid_P0_C1790_").val(),
				port: $("#rapid_P0_C1791_").val(),
				security: $("#rapid_P0_C1794_").val(),
				userName: $("#rapid_P0_C1792_").val(),
				password: $("#rapid_P0_C1793_").val()
			};
			callback = function(data) {
				alert(data.message);
			};
		break;
		case "SAVEEMAIL" :
			data = {
				actionType: actionType,
				appId: "rapid",
				enabled: getData_checkbox(ev, "rapid_P0_C2023_"),
				host: $("#rapid_P0_C1790_").val(),
				port: $("#rapid_P0_C1791_").val(),
				security: $("#rapid_P0_C1794_").val(),
				userName: $("#rapid_P0_C1792_").val(),
				password: $("#rapid_P0_C1793_").val()
			};
		break;
		case "DELAPPBACKUP" : case "RESTOREAPPBACKUP" : 
			data = { actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				backupId: $("#rapid_P0_C663_").find("tr.rowSelect").children("td").first().text() 
			};	
			callback = function(data) {
				$(data.controlId).hideDialogue();
				Event_change_rapid_P0_C1044_(ev);
				$("#rapid_P0_C662_").click();
			};														
		break;
		case "DELPAGEBACKUP" : case "RESTOREPAGEBACKUP" :	
			data = { actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				backupId: $("#rapid_P0_C678_").find("tr.rowSelect").children("td").first().text()  
			};	
			callback = function(data) {
				$(data.controlId).hideDialogue();
				Event_change_rapid_P0_C1044_(ev);
				$("#rapid_P0_C662_").click();
			};															
		break;
		case "SAVEAPPBACKUPSIZE" :			
			data = { actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				backupMaxSize: $("#rapid_P0_C685_").val()  
			};
		break;
		case "SAVEPAGEBACKUPSIZE" :
			data = { actionType: actionType, 
				appId: $("#rapid_P0_C43").val(), 
				version: $("#rapid_P0_C1044_").val(),
				backupMaxSize: $("#rapid_P0_C686_").val()  
			};
		break;
		default :
			data = { actionType: actionType, appId: "rapid" };
	}
	
	// stringify any data
	if (data) data = JSON.stringify(data);
	
	// run the action on the server	
	$.ajax({
    	url: "~?a=rapid&p=" + pageId + "&act=" + actionId,
    	type: "POST",          
    	dataType: "json",
        data: data,            
        error: function(server, status, error) { 
        	// re-enable target if a button
			if (target.is("button")) target.enable();
			// check security statuses
        	if (server && server.status && (server.status == 401 || server.status == 403)) {
        		window.location = "login.jsp";
        	} else if (errorCallback) {
        		errorCallback(server, status, error);
        	} else {
        		alert(server.responseText || "Error : " + status);
        	}
        },
        success: function(data) {
        	// re-enable target if a button
			if (target.is("button")) target.enable();
       		if (callback) callback(data);
       		if (successCallback) successCallback(data);        	
        }
	});
}	        
			]]>
	    </actionJavaScript>  
	     
    </action> 
</actions>